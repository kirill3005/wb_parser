# Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¿Ð¾ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸ÑŽ Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð² ÐŸÑ€Ð¸Ð·Ð½Ð°ÐºÐ¾Ð²

Ð­Ñ‚Ð¾Ñ‚ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ Ð¿Ñ€ÐµÐ´Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ñ…Ð¾Ñ‚ÑÑ‚ Ñ€Ð°ÑÑˆÐ¸Ñ€Ð¸Ñ‚ÑŒ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ñ„Ñ€ÐµÐ¹Ð¼Ð²Ð¾Ñ€ÐºÐ°, Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ ÑÐ²Ð¾Ð¸ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ, ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Ð¿Ñ€Ð¸Ð·Ð½Ð°ÐºÐ¾Ð².

## 1. ðŸŽ¯ ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²

Ð’ Ð¾ÑÐ½Ð¾Ð²Ðµ Ð½Ð°ÑˆÐµÐ¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð»ÐµÐ¶Ð¸Ñ‚ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹, Ð½Ð¾ Ð¼Ð¾Ñ‰Ð½Ñ‹Ð¹ Ð´Ð¸Ð·Ð°Ð¹Ð½:

1.  **ÐÐ±ÑÑ‚Ñ€Ð°ÐºÑ‚Ð½Ñ‹Ð¹ Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ ÐšÐ»Ð°ÑÑ:** Ð’ÑÐµ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð½Ð°ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚ `ml_foundry.features.base.FeatureGenerator`. Ð­Ñ‚Ð¾Ñ‚ ÐºÐ»Ð°ÑÑ- "ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚" Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ð¾Ð² `fit` Ð¸ `transform`.

2.  **Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ ÐžÐ±ÑƒÑ‡ÐµÐ½Ð¸Ñ (`fit_strategy`):** ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ð¸Ð¼ÐµÐµÑ‚ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚ `fit_strategy`, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑÐ¾Ð¾Ð±Ñ‰Ð°ÐµÑ‚ Ð¾Ñ€ÐºÐµÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ `make_features.py`, Ð½Ð° ÐºÐ°ÐºÐ¸Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… ÐµÐ³Ð¾ Ð¾Ð±ÑƒÑ‡Ð°Ñ‚ÑŒ.
    *   `fit_strategy = "train_only"` (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ): ÐœÐµÑ‚Ð¾Ð´ `.fit()` Ð±ÑƒÐ´ÐµÑ‚ Ð²Ñ‹Ð·Ð²Ð°Ð½ **Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½Ð° Ð¾Ð±ÑƒÑ‡Ð°ÑŽÑ‰ÐµÐ¹ Ð²Ñ‹Ð±Ð¾Ñ€ÐºÐµ**. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð½ÑÑ‚Ð²Ð° Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð², Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ Ð´Ð»Ñ supervised.
    *   `fit_strategy = "combined"`: ÐœÐµÑ‚Ð¾Ð´ `.fit()` Ð±ÑƒÐ´ÐµÑ‚ Ð²Ñ‹Ð·Ð²Ð°Ð½ Ð½Ð° **Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… (train + test)**. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ unsupervised-Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¼ Ð½ÑƒÐ¶Ð½Ð¾ Ð²Ñ‹ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½ÑƒÑŽ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `AggregationGenerator`, `AutoencoderFeatureGenerator`).

3.  **ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ:** Ð’Ð°Ð¼ **Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð½Ð¸Ð³Ð´Ðµ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ** Ð²Ð°Ñˆ Ð½Ð¾Ð²Ñ‹Ð¹ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐºÐ°Ð½Ð¸Ñ€ÑƒÐµÑ‚ Ð²ÑÐµ `.py` Ñ„Ð°Ð¹Ð»Ñ‹ Ð² `src/features/` (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð²ÑÐµ Ð¿Ð¾Ð´Ð¿Ð°Ð¿ÐºÐ¸) Ð¸ Ð´ÐµÐ»Ð°ÐµÑ‚ Ð¸Ñ… Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¼Ð¸ Ð´Ð»Ñ Hydra.

---

## 2. ðŸš€ Ð¢ÑƒÑ‚Ð¾Ñ€Ð¸Ð°Ð»: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð’Ð°ÑˆÐµÐ³Ð¾ ÐŸÐµÑ€Ð²Ð¾Ð³Ð¾ Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°

Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ ÑÐ¾Ð·Ð´Ð°Ð´Ð¸Ð¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÑ‚ Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ðµ Ð¼ÐµÐ¶Ð´Ñƒ Ð´Ð²ÑƒÐ¼Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°Ð¼Ð¸.

**Ð¨Ð°Ð³ 1: Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð»**

Ð›ÑƒÑ‡ÑˆÐµÐµ Ð¼ÐµÑÑ‚Ð¾ Ð´Ð»Ñ Ð²Ð°ÑˆÐ¸Ñ… Ð»Ð¸Ñ‡Ð½Ñ‹Ñ…, ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð² â€” ÑÑ‚Ð¾ Ð¿Ð°Ð¿ÐºÐ° `src/features/custom/`.

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð»: `src/features/custom/ratio_generator.py`

**Ð¨Ð°Ð³ 2: ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÐºÐ¾Ð´**

```python
# src/features/custom/ratio_generator.py

import pandas as pd
from ..base import FeatureGenerator # ðŸ‘ˆ ÐÐ°ÑÐ»ÐµÐ´ÑƒÐµÐ¼ÑÑ Ð¾Ñ‚ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð³Ð¾ ÐºÐ»Ð°ÑÑÐ°

class RatioFeatureGenerator(FeatureGenerator):
    """
    Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¸Ð·Ð½Ð°Ðº ÐºÐ°Ðº Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ðµ Ð´Ð²ÑƒÑ… ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº (col_a / col_b).
    """
    # Ð­Ñ‚Ð¾Ñ‚ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ - unsupervised Ð¸ stateless. Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
    # "train_only" Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚, Ñ‚Ð°Ðº ÐºÐ°Ðº .fit() Ð²ÑÐµ Ñ€Ð°Ð²Ð½Ð¾ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð´ÐµÐ»Ð°ÐµÑ‚.
    
    def __init__(self, name: str, col_a: str, col_b: str, epsilon: float = 1e-6):
        super().__init__(name)
        self.col_a = col_a
        self.col_b = col_b
        self.epsilon = epsilon

    def fit(self, data: pd.DataFrame) -> None:
        # Ð­Ñ‚Ð¾Ñ‚ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ fit Ð¿ÑƒÑÑ‚Ð¾Ð¹.
        pass

    def transform(self, data: pd.DataFrame) -> pd.DataFrame:
        df = data.copy()
        new_col_name = f"{self.name}_{self.col_a}_div_{self.col_b}"
        df[new_col_name] = df[self.col_a] / (df[self.col_b] + self.epsilon)
        return df
```

**Ð¨Ð°Ð³ 3: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐµÐ³Ð¾ Ð² Ð²Ð°ÑˆÐµÐ¼ ÐºÐ¾Ð½Ð²ÐµÐ¹ÐµÑ€Ðµ**

Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð¾Ñ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð»ÑŽÐ±Ð¾Ð¹ `.yaml` Ñ„Ð°Ð¹Ð» Ð² `conf/feature_engineering/` Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ ÑˆÐ°Ð³ Ð² `pipeline`, ÑƒÐºÐ°Ð·Ð°Ð² **Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ** Ðº Ð²Ð°ÑˆÐµÐ¼Ñƒ Ð½Ð¾Ð²Ð¾Ð¼Ñƒ ÐºÐ»Ð°ÑÑÑƒ.

```yaml
# conf/feature_engineering/my_custom_pipeline.yaml

name: "my_custom_pipeline"

pipeline:
  # ... Ð´Ñ€ÑƒÐ³Ð¸Ðµ ÑˆÐ°Ð³Ð¸ ...

  # ðŸ‘‡ ÐÐ°Ñˆ Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ ÑˆÐ°Ð³
  - _target_: ml_foundry.features.custom.ratio_generator.RatioFeatureGenerator
    name: "income_to_age_ratio"
    col_a: "income"
    col_b: "age"
```

**Ð¨Ð°Ð³ 4: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ `make_features`**

```bash
python src/make_features.py feature_engineering=my_custom_pipeline
```

**Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!** Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ `make_features.py` Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶Ð¸Ñ‚, Ð¸Ð½ÑÑ‚Ð°Ð½Ñ†Ð¸Ð¸Ñ€ÑƒÐµÑ‚ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ Ð²Ð°Ñˆ Ð½Ð¾Ð²Ñ‹Ð¹ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€.

---

## 3. ðŸ“š Ð¡Ð¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸Ðº Ð¿Ð¾ "Ð¯Ð´ÐµÑ€Ð½Ñ‹Ð¼" Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°Ð¼

Ð§Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð±Ð¾Ð»ÐµÐµ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ñ… Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð² Ð¸ Ð¿Ð¾Ð½ÑÑ‚ÑŒ, ÐºÐ°Ðº Ð¾Ð½Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚, Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ðº Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¼ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð°Ð¼:

> ðŸ“– **[ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð¡Ð¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸Ðº Ð¿Ð¾ Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°Ð¼ ÐŸÑ€Ð¸Ð·Ð½Ð°ÐºÐ¾Ð² (docs/README.md)](../../docs/feature_generators/README.md)**